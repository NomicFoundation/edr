diff --git a/dist/src/sandbox.d.ts b/dist/src/sandbox.d.ts
index ade4d57a5ed41dfbd1c6a91bb88aa10f994591c8..b8cb3e9974fbc636bfb0aa253a9bbee8578c1969 100644
--- a/dist/src/sandbox.d.ts
+++ b/dist/src/sandbox.d.ts
@@ -1,11 +1,11 @@
 import { FactoryOptions } from '@nomiclabs/hardhat-ethers/types';
 import { BaseContract, ContractFactory, ethers } from 'ethers';
-import { EDRProvider, FakeContract, FakeContractOptions, FakeContractSpec, MockContractFactory } from './types';
+import { FakeContract, FakeContractOptions, FakeContractSpec, MockContractFactory } from './types';
 export declare class Sandbox {
     private vm;
     private static nonce;
     private addressToSighashToFunction;
-    constructor(provider: EDRProvider);
+    private constructor();
     private overrideCall;
     private getCalledFunction;
     private addFunctionToMap;
diff --git a/dist/src/sandbox.js b/dist/src/sandbox.js
index fc1f25f3172f09b143d28e06d7267ab096fbf541..372e4096aab6182ad98b69ce398964fe2a01f967 100644
--- a/dist/src/sandbox.js
+++ b/dist/src/sandbox.js
@@ -32,7 +32,6 @@ class Sandbox {
     constructor(provider) {
         this.addressToSighashToFunction = new Map();
         this.vm = new observable_vm_1.ObservableVM(provider._node._vm);
-        provider._setCallOverrideCallback((address, data) => this.overrideCall(address, data));
     }
     async overrideCall(address, data) {
         const calledFunction = this.getCalledFunction(address, data);
@@ -76,12 +75,15 @@ class Sandbox {
         if (hardhat_1.default.network.name !== 'hardhat') {
             throw new Error(`Smock is only compatible with the "hardhat" network, got: ${hardhat_1.default.network.name}. Follow this issue for more info: https://github.com/defi-wonderland/smock/issues/29`);
         }
-        const provider = await (0, utils_1.getHardhatBaseProvider)(hardhat_1.default);
-        const node = provider._node;
+        const providerAny = await (0, utils_1.getHardhatBaseProvider)(hardhat_1.default);
+        const node = providerAny._node;
         if (node === undefined) {
-            await provider._init();
+            await providerAny._init();
         }
-        return new Sandbox(provider);
+        const provider = providerAny;
+        const sandbox = new Sandbox(provider);
+        await provider._setCallOverrideCallback((address, data) => sandbox.overrideCall(address, data));
+        return sandbox;
     }
     static getNextNonce() {
         return Sandbox.nonce++;
diff --git a/dist/src/sandbox.js.map b/dist/src/sandbox.js.map
index 85fcf3742c59af40322f0d260bce79e154cbece7..31b0f100d43ecee1648138baf94746fdd74a5cf4 100644
--- a/dist/src/sandbox.js.map
+++ b/dist/src/sandbox.js.map
@@ -1 +1 @@
-{"version":3,"file":"sandbox.js","sourceRoot":"","sources":["../../src/sandbox.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"sandbox.js","sourceRoot":"","sources":["../../src/sandbox.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/src/types.d.ts b/dist/src/types.d.ts
index eb61f3d20c4111dd9f86b60f13122730221c5a31..892a0ece779b0d92d79ab940fc0dd53f04e6a477 100644
--- a/dist/src/types.d.ts
+++ b/dist/src/types.d.ts
@@ -92,7 +92,7 @@ export type CallOverrideCallback = (address: Buffer, data: Buffer) => Promise<{
     shouldRevert: boolean;
 } | undefined>;
 export interface EDRProvider {
-    _setCallOverrideCallback(callback: CallOverrideCallback): void;
+    _setCallOverrideCallback(callback: CallOverrideCallback): Promise<void>;
     _node: {
         _vm: VM;
     };
